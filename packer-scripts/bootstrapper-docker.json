{
  "variables": {
    "terraform_version": "0.12.6",
    "tf_plugin_consul_version": "2.5.0",
    "tf_plugin_nomad_version": "1.4.1",
    "tf_plugin_null_version": "2.1.2",
    "tf_plugin_template_version": "2.1.2",
    "tf_plugin_ucloud_version": "1.11.1",
    "tf_plugin_external_version": "1.2.0",
    "docker_repo": "",
    "image_tag": "",
    "docker_login_server": "",
    "docker_login_username": "",
    "docker_login_password": ""
  },

  "builders": [{
    "type": "docker",
    "image": "alpine:3.10.1",
    "commit": true,
    "changes": [
      "CMD [\"\"]",
      "ENTRYPOINT [\"\"]"
    ]
  }],
  "provisioners": [
    {
      "type": "shell",
      "scripts": [
        "../scripts/config-apk.sh",
        "../scripts/install-bootstrapper.sh",
        "../scripts/build-terraform-plugin-cache.sh"
      ],
      "environment_vars": [
        "TERRAFORM_VERSION={{user `terraform_version`}}",
        "TF_PLUGIN_CONSUL_VERSION={{user `tf_plugin_consul_version`}}",
        "TF_PLUGIN_NOMAD_VERSION={{user `tf_plugin_nomad_version`}}",
        "TF_PLUGIN_NULL_VERSION={{user `tf_plugin_null_version`}}",
        "TF_PLUGIN_TEMPLATE_VERSION={{user `tf_plugin_template_version`}}",
        "TF_PLUGIN_UCLOUD_VERSION={{user `tf_plugin_ucloud_version`}}",
        "TF_PLUGIN_EXTERNAL_VERSION={{user `tf_plugin_external_version`}}"
      ]
    }],
  "post-processors": [
    [
      {
        "type": "docker-tag",
        "repository": "{{user `docker_repo`}}",
        "tag": "{{user `image_tag`}}"
      },
      {
        "type": "docker-push",
        "login_server": "{{user `docker_login_server`}}",
        "login_username": "{{user `docker_login_username`}}",
        "login_password": "{{user `docker_login_password`}}",
        "login": true
      }
    ]
  ]
}