{
  "variables": {
    "ucloud_public_key": "{{env `UCLOUD_PUBKEY`}}",
    "ucloud_private_key": "{{env `UCLOUD_SECRET`}}",
    "ssh_user": "root",
    "ssh_password": "",
    "ucloud_project_id": "",
    "image_id": "uimage-dpdgyw",
    "consul_version": "1.5.3",
    "nomad_version": "0.9.4",
    "region": "cn-bj2",
    "az": "cn-bj2-02",
    "tf_plugin_consul_version": "2.5.0",
    "tf_plugin_nomad_version": "1.4.1",
    "tf_plugin_null_version": "2.1.2",
    "tf_plugin_template_version": "2.1.2",
    "tf_plugin_ucloud_version": "1.12.1",
    "tf_plugin_external_version": "1.2.0",
    "tf_plugin_local_version": "1.3.0",
    "yum_base": "http://mirrors.163.com/.help/CentOS7-Base-163.repo",
    "yum_docker": "https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo",
    "docker_rpm": "http://hashicorpfile.cn-bj.ufileos.com/docker-ce-18.03.1.ce-1.el7.centos.x86_64.rpm",
    "docker_cli_rpm": "http://hashicorpfile.cn-bj.ufileos.com/docker-ce-cli-19.03.2-3.el7.x86_64.rpm",
    "file_server": "http://hashicorpfile.cn-bj.ufileos.com",
    "cfssl_tool_server": "https://pkg.cfssl.org/R1.2",
    "use_ssh_private_ip": "false",
    "vpc_id": "",
    "subnet_id": ""
  },

  "builders": [{
    "type": "ucloud-uhost",
    "public_key":"{{user `ucloud_public_key`}}",
    "private_key":"{{user `ucloud_private_key`}}",
    "project_id": "{{user `ucloud_project_id`}}",
    "region": "{{user `region`}}",
    "availability_zone": "{{user `az`}}",
    "instance_type": "n-basic-2",
    "source_image_id":"{{user `image_id`}}",
    "ssh_username":"{{user `ssh_user`}}",
    "ssh_password": "{{user `ssh_password`}}",
    "image_name": "nomad-client-{{user `nomad_version`}}-consul-{{user `consul_version`}}",
    "use_ssh_private_ip": "{{user `use_ssh_private_ip`}}",
    "vpc_id": "{{user `vpc_id`}}",
    "subnet_id": "{{user `subnet_id`}}"
  }],
  "provisioners": [
    {
      "type": "shell",
      "scripts": [
        "../scripts/config-yum.sh",
        "../scripts/consul-service.sh",
        "../scripts/nomad-service.sh",
        "../scripts/install-docker.sh",
        "../scripts/config-consul-agent.sh",
        "../scripts/nomad-client.sh",
        "../scripts/build-terraform-plugin-cache.sh"
      ],
      "environment_vars": [
        "CONSUL_VERSION={{user `consul_version`}}",
        "NOMAD_VERSION={{user `nomad_version`}}",
        "YUM_BASE={{user `yum_base`}}",
        "YUM_DOCKER={{user `yum_docker`}}",
        "DOCKER_RPM={{user `docker_rpm`}}",
        "DOCKER_CLI_RPM={{user `docker_cli_rpm`}}",
        "TF_PLUGIN_CONSUL_VERSION={{user `tf_plugin_consul_version`}}",
        "TF_PLUGIN_NOMAD_VERSION={{user `tf_plugin_nomad_version`}}",
        "TF_PLUGIN_NULL_VERSION={{user `tf_plugin_null_version`}}",
        "TF_PLUGIN_TEMPLATE_VERSION={{user `tf_plugin_template_version`}}",
        "TF_PLUGIN_UCLOUD_VERSION={{user `tf_plugin_ucloud_version`}}",
        "TF_PLUGIN_EXTERNAL_VERSION={{user `tf_plugin_external_version`}}",
        "TF_PLUGIN_LOCAL_VERSION={{user `tf_plugin_local_version`}}",
        "FILE_SERVER={{user `file_server`}}",
        "CFSSL_TOOL_SERVER={{user `cfssl_tool_server`}}"
      ]
    }]
}
